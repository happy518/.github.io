<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="5AUIVYTbHIAuz-eQtxSfZbWW5eg9_EVZMSQycIuXrG0">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"theme-next.js.org","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"default"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.15.0/config.min.js"></script>

    <meta name="description" content="MySQL工具之innodb_ruby：探究InnoDB存储结构的利器">
<meta property="og:type" content="article">
<meta property="og:title" content="mysql学习笔记-Mysql工具之innodb_ruby：探究InnoDB存储结构的利器">
<meta property="og:url" content="https://theme-next.js.org/mysql/learn-mysql-021/index.html">
<meta property="og:site_name" content="亦彤blog">
<meta property="og:description" content="MySQL工具之innodb_ruby：探究InnoDB存储结构的利器">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327163213077.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327164232473.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327165318132.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327165844024.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/modb_20211120_752ec134-49b6-11ec-adf3-38f9d3cd240d.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/modb_20211120_753e74a8-49b6-11ec-adf3-38f9d3cd240d.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327171348204.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327171458177.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327180443634.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327181438638.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327181655575.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327181819041.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327181952283.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327182305370.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327182937848.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327183306953.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327183647822.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327184200586.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327184524277.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/modb_20211120_783b79ee-49b6-11ec-adf3-38f9d3cd240d.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327185142292.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327190015480.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327190619666.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327191903009.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327192114564.png">
<meta property="og:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327192244144.png">
<meta property="article:published_time" content="2023-03-25T08:56:25.000Z">
<meta property="article:modified_time" content="2023-04-10T09:17:24.656Z">
<meta property="article:author" content="yangpengbing">
<meta property="article:tag" content="mysql5.7">
<meta property="article:tag" content="innobd_ruby">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://theme-next.js.org/mysql/learn-mysql-021/image-20230327163213077.png">


<link rel="canonical" href="https://theme-next.js.org/mysql/learn-mysql-021/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://theme-next.js.org/mysql/learn-mysql-021/","path":"mysql/learn-mysql-021/","title":"mysql学习笔记-Mysql工具之innodb_ruby：探究InnoDB存储结构的利器"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>mysql学习笔记-Mysql工具之innodb_ruby：探究InnoDB存储结构的利器 | 亦彤blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-43861RVV8R"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-43861RVV8R","only_pageview":false}</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.15.0/third-party/analytics/google-analytics.min.js"></script>








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="亦彤blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">亦彤blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-bell fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">60</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#innodb-ruby%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">innodb_ruby简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E8%AF%AD%E6%B3%95"><span class="nav-number">1.1.</span> <span class="nav-text">命令语法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="nav-number">2.</span> <span class="nav-text">数据准备</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="nav-number">2.1.</span> <span class="nav-text">表结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F-%E4%BD%BF%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%86%85%E5%AD%98%E8%A1%A8"><span class="nav-number">2.2.</span> <span class="nav-text">第一种方式: 使用存储过程和内存表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F-%E4%BD%BF%E7%94%A8mysqlslap%E7%94%9F%E6%88%90%E5%A4%A7%E9%87%8F%E7%9A%84%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="nav-number">2.3.</span> <span class="nav-text">第二种方式: 使用mysqlslap生成大量的测试数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9A%E9%87%87%E7%94%A8%E4%B8%B4%E6%97%B6%E8%A1%A8"><span class="nav-number">2.4.</span> <span class="nav-text">第三种方式：采用临时表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#space-%E8%A1%A8%E7%A9%BA%E9%97%B4-%E7%9B%B8%E5%85%B3"><span class="nav-number">3.</span> <span class="nav-text">space(表空间)相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E6%89%80%E6%9C%89%E5%8F%AF%E7%94%A8%E7%9A%84%E8%A1%A8%E7%A9%BA%E9%97%B4%E5%8F%8A%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF"><span class="nav-number">3.1.</span> <span class="nav-text">查看系统所有可用的表空间及统计信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8Bt-people%E8%A1%A8%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE%E5%88%86%E5%B8%83"><span class="nav-number">3.2.</span> <span class="nav-text">查看t_people表空间数据分布</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8Bt-people%E8%A1%A8%E6%95%B0%E6%8D%AE%E8%A1%8C%E5%88%86%E5%B8%83%E6%83%85%E5%86%B5%EF%BC%9A"><span class="nav-number">3.3.</span> <span class="nav-text">查看t_people表数据行分布情况：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%AF%B9%E5%BA%94%E8%A1%A8%E7%A9%BA%E9%97%B4%E7%9A%84%E5%8C%BA-Extent-%E4%BF%A1%E6%81%AF"><span class="nav-number">3.4.</span> <span class="nav-text">查看对应表空间的区(Extent)信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%AE%B5%E7%9A%84%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7%E4%BF%A1%E6%81%AF-INODE"><span class="nav-number">3.5.</span> <span class="nav-text">查看段的相关属性信息(INODE)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84%E5%92%8C%E6%95%B0%E6%8D%AE%E5%88%86%E5%B8%83%E6%83%85%E5%86%B5"><span class="nav-number">3.6.</span> <span class="nav-text">查看索引结构和数据分布情况</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%A1%A8%E7%A9%BA%E9%97%B4%E6%89%80%E6%9C%89%E9%A1%B5%E9%9D%A2%E7%9A%84LSN"><span class="nav-number">3.7.</span> <span class="nav-text">查看表空间所有页面的LSN</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Index-B-%E6%A0%91%E7%B4%A2%E5%BC%95-%E7%9B%B8%E5%85%B3"><span class="nav-number">4.</span> <span class="nav-text">Index(B+树索引)相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%8D%E5%8E%86%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95%E6%95%B4%E4%B8%AAB-%E6%A0%91%EF%BC%8C%E6%89%AB%E6%8F%8F%E6%89%80%E6%9C%89%E9%A1%B5%E9%9D%A2"><span class="nav-number">4.1.</span> <span class="nav-text">遍历聚集索引整个B+树，扫描所有页面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%8D%E5%8E%86%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95B-%E6%A0%91%E7%9A%84%E6%95%B0%E6%8D%AE%E9%A1%B5Page%E5%92%8C%E8%AE%B0%E5%BD%95Record%E7%9A%84%E5%81%8F%E7%A7%BB%E9%87%8F"><span class="nav-number">4.2.</span> <span class="nav-text">遍历聚集索引B+树的数据页Page和记录Record的偏移量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9ALevel-B-%E6%A0%91%E9%AB%98-%E7%9A%84%E6%89%80%E6%9C%89%E9%A1%B5%E9%9D%A2%E4%BF%A1%E6%81%AF"><span class="nav-number">4.3.</span> <span class="nav-text">查看指定Level(B+树高)的所有页面信息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Page-%E6%95%B0%E6%8D%AE%E9%A1%B5-%E7%9B%B8%E5%85%B3"><span class="nav-number">5.</span> <span class="nav-text">Page(数据页)相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E9%A1%B5%E5%8F%B7-PAGE-NO-%E7%9A%84%E6%95%B0%E6%8D%AE%E9%A1%B5%E8%AF%B4%E6%98%8E%E4%BF%A1%E6%81%AF"><span class="nav-number">5.1.</span> <span class="nav-text">查看指定页号(PAGE_NO)的数据页说明信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E9%A1%B5%E5%8F%B7-PAGE-NO-%E9%A1%B5%E7%9B%AE%E5%BD%95%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="nav-number">5.2.</span> <span class="nav-text">查看指定页号(PAGE_NO)页目录的信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95%E7%9A%84%E9%9D%9E%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9%EF%BC%88Clustered-Index-Non-Leaf%EF%BC%89%E8%AE%B0%E5%BD%95-Record-%E4%BF%A1%E6%81%AF"><span class="nav-number">5.3.</span> <span class="nav-text">查看聚集索引的非叶子节点（Clustered Index Non-Leaf）记录 Record 信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95%E7%9A%84%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9-Clustered-Index-Leaf-%E8%AE%B0%E5%BD%95Record%E4%BF%A1%E6%81%AF"><span class="nav-number">5.4.</span> <span class="nav-text">查看聚集索引的叶子节点(Clustered Index Leaf)记录Record信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95%E7%9A%84%E9%9D%9E%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9%EF%BC%88Secondary-Index-Non-Leaf%EF%BC%89%E8%AE%B0%E5%BD%95-Record-%E4%BF%A1%E6%81%AF%EF%BC%9A"><span class="nav-number">5.5.</span> <span class="nav-text">查看辅助索引的非叶子节点（Secondary Index Non-Leaf）记录 Record 信息：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95%E7%9A%84%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9-Secondary-Index-Leaf-%E8%AE%B0%E5%BD%95-Record-%E4%BF%A1%E6%81%AF"><span class="nav-number">5.6.</span> <span class="nav-text">查看辅助索引的叶子节点(Secondary Index Leaf)记录 Record 信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8Bt-people%E8%A1%A8%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE%E9%A1%B5Page%E7%9A%84%E8%AF%A6%E7%BB%86%E7%9A%84%E5%90%84%E5%B1%9E%E6%80%A7%E4%BF%A1%E6%81%AF%EF%BC%9A"><span class="nav-number">5.7.</span> <span class="nav-text">查看t_people表空间数据页Page的详细的各属性信息：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%9F%90%E4%B8%AAPage%E5%90%84%E5%B1%9E%E6%80%A7%E4%BF%A1%E6%81%AF%E7%A9%BA%E9%97%B4%E5%8D%A0%E7%94%A8%E6%83%85%E5%86%B5%E5%8F%8A%E7%99%BE%E5%88%86%E6%AF%94"><span class="nav-number">5.8.</span> <span class="nav-text">查看某个Page各属性信息空间占用情况及百分比</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Record-%E8%AE%B0%E5%BD%95-%E7%9B%B8%E5%85%B3"><span class="nav-number">6.</span> <span class="nav-text">Record(记录)相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E5%81%8F%E7%A7%BB%E9%87%8F%E7%9A%84%E8%AE%B0%E5%BD%95Record%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="nav-number">6.1.</span> <span class="nav-text">查看指定偏移量的记录Record详细信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E5%81%8F%E7%A7%BB%E9%87%8F%E8%AE%B0%E5%BD%95Record%E7%9A%84%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95-%E4%B8%BA%E6%8C%87%E5%AE%9A%E5%81%8F%E7%A7%BB%E9%87%8F%E8%AE%B0%E5%BD%95%E7%9A%84-UNDO-LOG"><span class="nav-number">6.2.</span> <span class="nav-text">查看指定偏移量记录Record的历史记录(为指定偏移量记录的 UNDO LOG)</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yangpengbing"
      src="/images/logo.svg">
  <p class="site-author-name" itemprop="name">yangpengbing</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">60</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hhcHB5NTE4" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;happy518"><i class="fab fa-github fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>
<div class="cc-license animated" itemprop="sponsor">
  <span class="exturl cc-opacity" title="Deploy with Netlify → https://www.netlify.com" data-url="aHR0cHM6Ly93d3cubmV0bGlmeS5jb20="><img width="120" src="https://www.netlify.com/img/global/badges/netlify-dark.svg" alt="Netlify"></span>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://theme-next.js.org/mysql/learn-mysql-021/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo.svg">
      <meta itemprop="name" content="yangpengbing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="亦彤blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="mysql学习笔记-Mysql工具之innodb_ruby：探究InnoDB存储结构的利器 | 亦彤blog">
      <meta itemprop="description" content="MySQL工具之innodb_ruby：探究InnoDB存储结构的利器">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          mysql学习笔记-Mysql工具之innodb_ruby：探究InnoDB存储结构的利器
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-03-25 16:56:25" itemprop="dateCreated datePublished" datetime="2023-03-25T16:56:25+08:00">2023-03-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">MySQL工具之innodb_ruby：探究InnoDB存储结构的利器</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <blockquote>
<p>innodb_ruby 是一款用 ruby 写的用来分析 innodb 物理文件的专业 DBA 工具，可以通过这款工具来窥探 innodb 内部的一些结构。</p>
</blockquote>
<h3 id="innodb-ruby简介"><a href="#innodb-ruby简介" class="headerlink" title="innodb_ruby简介"></a>innodb_ruby简介</h3><p>innodb_ruby是一款用ruby写的用来分析innodb物理文件的专业DBA工具，可以通过这款工具来窥探innodb内部的一些结构，注意不要在线上使用此工具，以避免对线上服务造成影响。官方网址 <span class="exturl" data-url="aHR0cHM6Ly9ydWJ5Z2Vtcy5vcmcvZ2Vtcy9pbm5vZGJfcnVieQ==">https://rubygems.org/gems/innodb_ruby<i class="fa fa-external-link-alt"></i></span>。</p>
<h4 id="命令语法"><a href="#命令语法" class="headerlink" title="命令语法"></a>命令语法</h4><p>在执行命令时，建议切换到mysql的datadir目录里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br></pre></td><td class="code"><pre><span class="line">sxf@ubuntu:~$ innodb_space --help</span><br><span class="line"></span><br><span class="line">Usage: innodb_space &lt;options&gt; &lt;mode&gt;</span><br><span class="line">innodb_space &lt;选项&gt; &lt;模式&gt;</span><br><span class="line">命令主要分 options 和 mode 两大部分。</span><br><span class="line"></span><br><span class="line">Invocation examples:</span><br><span class="line"></span><br><span class="line">  innodb_space -s ibdata1 [-T tname [-I iname]] [options] &lt;mode&gt;</span><br><span class="line">    Use ibdata1 as the system tablespace and load the tname table (and the</span><br><span class="line">    iname index for modes that require it) from data located in the system</span><br><span class="line">    tablespace data dictionary. This will automatically generate a record</span><br><span class="line">    describer for any indexes.</span><br><span class="line"></span><br><span class="line">    参数：</span><br><span class="line">    -s 参数指的是系统表空间文件 ibdata1, 这个一般在datadir目录里可以找到。</span><br><span class="line">    -T 数据表名称，一般为数据库其中一个表的物理文件路径</span><br><span class="line">    -I 表示索引的名称, 如果是主键的话，直接填写 -I PRIMARY 即可，此时可省略此参数</span><br><span class="line"></span><br><span class="line">    如 innodb_space -s ibdata1 -T lab/tb space-indexes,则表示查看lab数据库的tb表的索引统计信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  innodb_space -f tname.ibd [-r ./desc.rb -d DescClass] [options] &lt;mode&gt;</span><br><span class="line">    Use the tname.ibd table (and the DescClass describer where required).</span><br><span class="line"></span><br><span class="line">The following options are supported:</span><br><span class="line"></span><br><span class="line">  --help, -?</span><br><span class="line">    Print this usage text.</span><br><span class="line"></span><br><span class="line">  --trace, -t</span><br><span class="line">    Enable tracing of all data read. Specify twice to enable even more</span><br><span class="line">    tracing (including reads during opening of the tablespace) which can</span><br><span class="line">    be quite noisy.</span><br><span class="line"></span><br><span class="line">  --system-space-file, -s &lt;arg&gt;</span><br><span class="line">    Load the system tablespace file or files &lt;arg&gt;: Either a single file e.g.</span><br><span class="line">    &quot;ibdata1&quot;, a comma-delimited list of files e.g. &quot;ibdata1,ibdata1&quot;, or a</span><br><span class="line">    directory name. If a directory name is provided, it will be scanned for all</span><br><span class="line">    files named &quot;ibdata?&quot; which will then be sorted alphabetically and used to</span><br><span class="line">    load the system tablespace.</span><br><span class="line"></span><br><span class="line">  --table-name, -T &lt;name&gt;</span><br><span class="line">    Use the table name &lt;name&gt;.</span><br><span class="line">    表名</span><br><span class="line"></span><br><span class="line">  --index-name, -I &lt;name&gt;</span><br><span class="line">    Use the index name &lt;name&gt;.</span><br><span class="line">    索引名</span><br><span class="line"></span><br><span class="line">  --space-file, -f &lt;file&gt;</span><br><span class="line">    Load the tablespace file &lt;file&gt;.</span><br><span class="line"></span><br><span class="line">  --page, -p &lt;page&gt;</span><br><span class="line">    Operate on the page &lt;page&gt;.</span><br><span class="line">    页数</span><br><span class="line"></span><br><span class="line">  --level, -l &lt;level&gt;</span><br><span class="line">    Operate on the level &lt;level&gt;.</span><br><span class="line">    索引树层级数，一般不会超过3</span><br><span class="line"></span><br><span class="line">  --list, -L &lt;list&gt;</span><br><span class="line">    Operate on the list &lt;list&gt;.</span><br><span class="line"></span><br><span class="line">  --fseg-id, -F &lt;fseg_id&gt;</span><br><span class="line">      Operate on the file segment (fseg) &lt;fseg_id&gt;.</span><br><span class="line"></span><br><span class="line">  --require, -r &lt;file&gt;</span><br><span class="line">    Use Ruby&#x27;s &quot;require&quot; to load the file &lt;file&gt;. This is useful for loading</span><br><span class="line">    classes with record describers.</span><br><span class="line"></span><br><span class="line">  --describer, -d &lt;describer&gt;</span><br><span class="line">    Use the named record describer to parse records in index pages.</span><br><span class="line"></span><br><span class="line">The following modes are supported:</span><br><span class="line">模式项列表</span><br><span class="line"></span><br><span class="line">  系统表空间</span><br><span class="line">  system-spaces</span><br><span class="line">    Print a summary of all spaces in the system.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  数据字典表(information_schema中数据库SYS_TABLES表内容，下同)</span><br><span class="line">  data-dictionary-tables</span><br><span class="line">    Print all records in the SYS_TABLES data dictionary table.</span><br><span class="line"></span><br><span class="line">  data-dictionary-columns</span><br><span class="line">    Print all records in the SYS_COLUMNS data dictionary table.</span><br><span class="line"></span><br><span class="line">  data-dictionary-indexes</span><br><span class="line">    Print all records in the SYS_INDEXES data dictionary table.</span><br><span class="line"></span><br><span class="line">  data-dictionary-fields</span><br><span class="line">    Print all records in the SYS_FIELDS data dictionary table.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  汇总表空间中的所有页信息，需要使用 --page/-p 参数指定页数</span><br><span class="line">  space-summary</span><br><span class="line">    Summarize all pages within a tablespace. A starting page number can be</span><br><span class="line">    provided with the --page/-p argument.</span><br><span class="line"></span><br><span class="line">  汇总表空间中的所有索引页信息，对于分析每个页记录填充率情况的时候很有用，同样需要使用--page/-p指定页数</span><br><span class="line">  space-index-pages-summary</span><br><span class="line">    Summarize all &quot;INDEX&quot; pages within a tablespace. This is useful to analyze</span><br><span class="line">    page fill rates and record counts per page. In addition to &quot;INDEX&quot; pages,</span><br><span class="line">    &quot;ALLOCATED&quot; pages are also printed and assumed to be completely empty.</span><br><span class="line">    A starting page number can be provided with the --page/-p argument.</span><br><span class="line"></span><br><span class="line">  与space-index-pages-summary差不多，但只显示一些摘要信息，需要配合参数一块使用</span><br><span class="line">  space-index-fseg-pages-summary</span><br><span class="line">    The same as space-index-pages-summary but only iterate one fseg, provided</span><br><span class="line">    with the --fseg-id/-F argument.</span><br><span class="line"></span><br><span class="line">  space-index-pages-free-plot</span><br><span class="line">    Use Ruby&#x27;s gnuplot module to produce a scatterplot of page free space for</span><br><span class="line">    all &quot;INDEX&quot; and &quot;ALLOCATED&quot; pages in a tablespace. More aesthetically</span><br><span class="line">    pleasing plots can be produced with space-index-pages-summary output,</span><br><span class="line">    but this is a quick and easy way to produce a passable plot. A starting</span><br><span class="line">    page number can be provided with the --page/-p argument.</span><br><span class="line"></span><br><span class="line">  遍历空间中的所有页面，统计每个类型的页共占用了多少页</span><br><span class="line">  space-page-type-regions</span><br><span class="line">    Summarize all contiguous regions of the same page type. This is useful to</span><br><span class="line">    provide an overall view of the space and allocations within it. A starting</span><br><span class="line">    page number can be provided with the --page/-p argument.</span><br><span class="line"></span><br><span class="line">  按类型汇总所有页面信息</span><br><span class="line">  space-page-type-summary</span><br><span class="line">    Summarize all pages by type. A starting page number can be provided with</span><br><span class="line">    the --page/-p argument.</span><br><span class="line"></span><br><span class="line">  表空间中所有索引统计信息（系统空间或每个文件表空间）</span><br><span class="line">  space-indexes</span><br><span class="line">    Summarize all indexes (actually each segment of the indexes) to show</span><br><span class="line">    the number of pages used and allocated, and the segment fill factor.</span><br><span class="line"></span><br><span class="line">  space-lists</span><br><span class="line">    Print a summary of all lists in a space.</span><br><span class="line"></span><br><span class="line">  space-list-iterate</span><br><span class="line">    Iterate through the contents of a space list.</span><br><span class="line"></span><br><span class="line">  space-extents</span><br><span class="line">    Iterate through all extents, printing the extent descriptor bitmap.</span><br><span class="line"></span><br><span class="line">  space-extents-illustrate</span><br><span class="line">    Iterate through all extents, illustrating the extent usage using ANSI</span><br><span class="line">    color and Unicode box drawing characters to show page usage throughout</span><br><span class="line">    the space.</span><br><span class="line"></span><br><span class="line">  space-extents-illustrate-svg</span><br><span class="line">    Iterate through all extents, illustrating the extent usage in SVG format</span><br><span class="line">    printed to stdout to show page usage throughout the space.</span><br><span class="line"></span><br><span class="line">  space-lsn-age-illustrate</span><br><span class="line">    Iterate through all pages, producing a heat map colored by the page LSN</span><br><span class="line">    using ANSI color and Unicode box drawing characters, allowing the user to</span><br><span class="line">    get an overview of page modification recency.</span><br><span class="line"></span><br><span class="line">  space-lsn-age-illustrate-svg</span><br><span class="line">    Iterate through all pages, producing a heat map colored by the page LSN</span><br><span class="line">    producing SVG format output, allowing the user to get an overview of page</span><br><span class="line">    modification recency.</span><br><span class="line"></span><br><span class="line">  space-inodes-fseg-id</span><br><span class="line">    Iterate through all inodes, printing only the FSEG ID.</span><br><span class="line"></span><br><span class="line">  space-inodes-summary</span><br><span class="line">    Iterate through all inodes, printing a short summary of each FSEG.</span><br><span class="line"></span><br><span class="line">  space-inodes-detail</span><br><span class="line">    Iterate through all inodes, printing a detailed report of each FSEG.</span><br><span class="line"></span><br><span class="line">  通过递归整个B+树（通过递归扫描所有页面，而不仅仅是按列表的叶子页面）来执行索引扫描（执行完整索引扫描）</span><br><span class="line">  index-recurse</span><br><span class="line">    Recurse an index, starting at the root (which must be provided in the first</span><br><span class="line">    --page/-p argument), printing the node pages, node pointers (links), leaf</span><br><span class="line">    pages. A record describer must be provided with the --describer/-d argument</span><br><span class="line">    to recurse indexes (in order to parse node pages).</span><br><span class="line"></span><br><span class="line">  将索引作为索引递归进行递归处理，但在索引页中打印每条记录的偏移量</span><br><span class="line">  index-record-offsets</span><br><span class="line">    Recurse an index as index-recurse does, but print the offsets of each</span><br><span class="line">    record within the page.</span><br><span class="line"></span><br><span class="line">  index-digraph</span><br><span class="line">    Recurse an index as index-recurse does, but print a dot-compatible digraph</span><br><span class="line">    instead of a human-readable summary.</span><br><span class="line"></span><br><span class="line">  打印指定 level 级别的所有page信息</span><br><span class="line">  index-level-summary</span><br><span class="line">    Print a summary of all pages at a given level (provided with the --level/-l</span><br><span class="line">    argument) in an index.</span><br><span class="line"></span><br><span class="line">  index-fseg-internal-lists</span><br><span class="line">  index-fseg-leaf-lists</span><br><span class="line">    Print a summary of all lists in an index file segment. Index root page must</span><br><span class="line">    be provided with --page/-p.</span><br><span class="line"></span><br><span class="line">  index-fseg-internal-list-iterate</span><br><span class="line">  index-fseg-leaf-list-iterate</span><br><span class="line">    Iterate the file segment list (whose name is provided in the first --list/-L</span><br><span class="line">    argument) for internal or leaf pages for a given index (whose root page</span><br><span class="line">    is provided in the first --page/-p argument). The lists used for each</span><br><span class="line">    index are &quot;full&quot;, &quot;not_full&quot;, and &quot;free&quot;.</span><br><span class="line"></span><br><span class="line">  index-fseg-internal-frag-pages</span><br><span class="line">  index-fseg-leaf-frag-pages</span><br><span class="line">    Print a summary of all fragment pages in an index file segment. Index root</span><br><span class="line">    page must be provided with --page/-p.</span><br><span class="line"></span><br><span class="line">  page-dump</span><br><span class="line">    Dump the contents of a page, using the Ruby pp (&quot;pretty-print&quot;) module.</span><br><span class="line"></span><br><span class="line">  page-account</span><br><span class="line">    Account for a page&#x27;s usage in FSEGs.</span><br><span class="line"></span><br><span class="line">  page-validate</span><br><span class="line">    Validate the contents of a page.</span><br><span class="line"></span><br><span class="line">  页目录字典记录</span><br><span class="line">  page-directory-summary</span><br><span class="line">    Summarize the record contents of the page directory in a page. If a record</span><br><span class="line">    describer is available, the key of each record will be printed.</span><br><span class="line"></span><br><span class="line">  对一个页的所有记录进行汇总</span><br><span class="line">  page-records</span><br><span class="line">    Summarize all records within a page.</span><br><span class="line"></span><br><span class="line">  详细说明一个页面的内容，并且根据类型进行着色显示</span><br><span class="line">  page-illustrate</span><br><span class="line">    Produce an illustration of the contents of a page.</span><br><span class="line"></span><br><span class="line">  record-dump</span><br><span class="line">    Dump a detailed description of a record and the data it contains. A record</span><br><span class="line">    offset must be provided with -R/--record.</span><br><span class="line"></span><br><span class="line">  record-history</span><br><span class="line">    Summarize the history (undo logs) for a record. A record offset must be</span><br><span class="line">    provided with -R/--record.</span><br><span class="line"></span><br><span class="line">  undo-history-summary</span><br><span class="line">    Summarize all records in the history list (undo logs).</span><br><span class="line"></span><br><span class="line">  undo-record-dump</span><br><span class="line">    Dump a detailed description of an undo record and the data it contains.</span><br><span class="line">    A record offset must be provided with -R/--record.</span><br></pre></td></tr></table></figure>

<h3 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h3><h4 id="表结构"><a href="#表结构" class="headerlink" title="表结构"></a>表结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `t_user` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `c_user_id` varchar(36) NOT NULL DEFAULT &#x27;&#x27;,</span><br><span class="line">  `c_name` varchar(22) NOT NULL DEFAULT &#x27;&#x27;,</span><br><span class="line">  `c_province_id` int(11) NOT NULL,</span><br><span class="line">  `c_city_id` int(11) NOT NULL,</span><br><span class="line">  `create_time` datetime NOT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `idx_user_id` (`c_user_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;</span><br></pre></td></tr></table></figure>

<h4 id="第一种方式-使用存储过程和内存表"><a href="#第一种方式-使用存储过程和内存表" class="headerlink" title="第一种方式: 使用存储过程和内存表"></a>第一种方式: 使用存储过程和内存表</h4><ul>
<li>创建内存表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 利用 MySQL 内存表插入速度快的特点，我们先利用函数和存储过程在内存表中生成数据，然后再从内存表插入普通表中</span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> t_user_memory <span class="keyword">like</span> t_user;</span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> t_user_memory engine <span class="operator">=</span> MEMORY;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建自定义函数和存储过程</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># 创建随机字符串和随机时间的函数</span><br><span class="line"># randStr</span><br><span class="line"><span class="keyword">CREATE</span> DEFINER<span class="operator">=</span>`root`@`<span class="operator">%</span>` <span class="keyword">FUNCTION</span> `randStr`(n <span class="type">int</span>) <span class="keyword">RETURNS</span> <span class="type">varchar</span>(<span class="number">255</span>) CHARSET utf8mb4</span><br><span class="line">    <span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> chars_str <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> return_str <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> ;</span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    WHILE i <span class="operator">&lt;</span> n DO</span><br><span class="line">        <span class="keyword">SET</span> return_str <span class="operator">=</span> concat(return_str, <span class="built_in">substring</span>(chars_str, <span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> RAND() <span class="operator">*</span> <span class="number">62</span>), <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line">    <span class="keyword">RETURN</span> return_str;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"># randNum</span><br><span class="line"><span class="keyword">CREATE</span> DEFINER<span class="operator">=</span>`root`@`<span class="operator">%</span>` <span class="keyword">FUNCTION</span> `randNum`(n <span class="type">int</span>) <span class="keyword">RETURNS</span> <span class="type">varchar</span>(<span class="number">36</span>) CHARSET utf8mb4</span><br><span class="line">    <span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> chars_str <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0123456789&#x27;</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> return_str <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> ;</span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    WHILE i <span class="operator">&lt;</span> n DO</span><br><span class="line">        <span class="keyword">SET</span> return_str <span class="operator">=</span> concat(return_str, <span class="built_in">substring</span>(chars_str, <span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> RAND() <span class="operator">*</span> <span class="number">10</span>), <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line">    <span class="keyword">RETURN</span> return_str;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"># randDataTime</span><br><span class="line"><span class="keyword">CREATE</span> DEFINER<span class="operator">=</span>`root`@`<span class="operator">%</span>` <span class="keyword">FUNCTION</span> `randDataTime`(sd DATETIME,ed DATETIME) <span class="keyword">RETURNS</span> datetime</span><br><span class="line">  <span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">DECLARE</span> sub <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">DECLARE</span> ret DATETIME;</span><br><span class="line">  <span class="keyword">SET</span> sub <span class="operator">=</span> <span class="built_in">ABS</span>(UNIX_TIMESTAMP(ed)<span class="operator">-</span>UNIX_TIMESTAMP(sd));</span><br><span class="line">  <span class="keyword">SET</span> ret <span class="operator">=</span> DATE_ADD(sd,<span class="type">INTERVAL</span> <span class="built_in">FLOOR</span>(<span class="number">1</span><span class="operator">+</span>RAND()<span class="operator">*</span>(sub<span class="number">-1</span>)) <span class="keyword">SECOND</span>);</span><br><span class="line">  <span class="keyword">RETURN</span> ret;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"># 创建插入数据存储过程</span><br><span class="line"><span class="keyword">CREATE</span> DEFINER<span class="operator">=</span>`root`@`<span class="operator">%</span>` <span class="keyword">PROCEDURE</span> `add_t_user_memory`(<span class="keyword">IN</span> n <span class="type">int</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">    WHILE (i <span class="operator">&lt;=</span> n) DO</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user_memory (c_user_id, c_name, c_province_id,c_city_id, create_time) <span class="keyword">VALUES</span> (randNum(<span class="number">6</span>), randStr(<span class="number">20</span>), <span class="built_in">FLOOR</span>(RAND() <span class="operator">*</span> <span class="number">1000</span>), <span class="built_in">FLOOR</span>(RAND() <span class="operator">*</span> <span class="number">100</span>), randDataTime(<span class="string">&#x27;2018-12-12 12:00:21&#x27;</span>, <span class="string">&#x27;2023-03-27 12:00:21&#x27;</span>));</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>调用存储过程</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CALL</span> add_t_user_memory(<span class="number">1000000</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>出现问题：</p>
<p>(1114, &quot;The table &#39;t_user_memory&#39; is full&quot;)</p>
<p><strong>出现内存已满时，修改 max_heap_table_size 参数的大小，我使用64M内存，插入了22W数据，看情况改，不过这个值不要太大，默认32M或者64M就好，生产环境不要乱尝试</strong></p>
</blockquote>
<ul>
<li>从内存表中插入普通表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> t_user <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user_memory;</span><br></pre></td></tr></table></figure>

<h4 id="第二种方式-使用mysqlslap生成大量的测试数据"><a href="#第二种方式-使用mysqlslap生成大量的测试数据" class="headerlink" title="第二种方式: 使用mysqlslap生成大量的测试数据"></a>第二种方式: 使用mysqlslap生成大量的测试数据</h4><ul>
<li>定义表结构</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 表结构</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_people` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `user_id` <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `c_name` <span class="type">varchar</span>(<span class="number">22</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `c_age` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `idx_user_id` (`user_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>mysqlslap插入数据</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlslap -h127.0.0.1 -uhadoop -p --concurrency=10 --number-of-queries=1000000 --commit=20000 --create-schema=&#x27;tbl_innodb_ruby&#x27; --query=&quot;insert into t_people(user_id, c_name, c_age) values (randNum(6), randStr(20), FLOOR(RAND() * 100));&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>concurrency: 并发数</p>
<p>number-of-queries: 查询的总次数</p>
</blockquote>
<h4 id="第三种方式：采用临时表"><a href="#第三种方式：采用临时表" class="headerlink" title="第三种方式：采用临时表"></a>第三种方式：采用临时表</h4><ul>
<li>创建临时数据表tmp_table</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tmp_table (</span><br><span class="line">  id <span class="type">INT</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>用 python或者bash 生成 100w 记录的数据文件（python瞬间就会生成完）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&quot;for i in range(1, 1+1000000): print(i)&quot;</span> &gt; base.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>导入数据到临时表tmp_table中</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; load data infile &#x27;/Users/LJTjintao/temp/base.txt&#x27; replace into table tmp_table;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意： 导入数据时有可能会报错，原因是mysql默认没有开secure_file_priv（ 这个参数用来限制数据导入和导出操作的效果，例如执行LOAD DATA、SELECT … INTO OUTFILE语句和LOAD_FILE()函数。这些操作需要用户具有FILE权限。 ）</p>
<p>解决办法：在mysql的配置文件中（my.ini 或者 my.conf）中添加 secure_file_priv &#x3D; &#x2F;Users&#x2F;LJTjintao&#x2F;temp&#x2F;&#96;, 然后重启mysql 解决</p>
</blockquote>
<ul>
<li>以临时表为基础数据，插入数据到t_user中</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   <span class="keyword">SELECT</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     id,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     uuid(),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     CONCAT(<span class="string">&#x27;userNickName&#x27;</span>, id),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="built_in">FLOOR</span>(Rand() <span class="operator">*</span> <span class="number">1000</span>),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="built_in">FLOOR</span>(Rand() <span class="operator">*</span> <span class="number">100</span>),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     NOW()</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   <span class="keyword">FROM</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     tmp_table;</span><br></pre></td></tr></table></figure>

<h3 id="space-表空间-相关"><a href="#space-表空间-相关" class="headerlink" title="space(表空间)相关"></a>space(表空间)相关</h3><h4 id="查看系统所有可用的表空间及统计信息"><a href="#查看系统所有可用的表空间及统计信息" class="headerlink" title="查看系统所有可用的表空间及统计信息"></a>查看系统所有可用的表空间及统计信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people system-spaces | sed &#x27;s/[,#$@!%~ ][ ]*/\t/g&#x27; | sed &#x27;s/\t/,/g&#x27; | sed &#x27;s/.$//&#x27; | csvlook</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327163213077.png" alt="image-20230327163213077" style="zoom:50%;"> 

<blockquote>
<p>第一列是表空间名，第二列是对应表空间所分配数据页(page)的数量，第三列是索引数量</p>
</blockquote>
<h4 id="查看t-people表空间数据分布"><a href="#查看t-people表空间数据分布" class="headerlink" title="查看t_people表空间数据分布"></a>查看t_people表空间数据分布</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people space-page-type-regions</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327164232473.png" alt="image-20230327164232473" style="zoom:50%;">

<p>哈哈，眼熟吗？还有印象吗</p>
<ul>
<li><p><strong>start</strong>：开始的PAGE_NO</p>
</li>
<li><p><strong>end</strong>：结束的PAGE_NO</p>
</li>
<li><p><strong>FSP_HDR</strong>：表空间第 1 个区的第 1 个页为FSP_HDR(file space header)，保存了这个表空间的大小，以及完全没有被使用的extents，fragment的以及inode使用情况，整个表空间只有一个 FSP_HDR 类型的页面。如图，count 列表示占用的 Page 数量为 1；</p>
</li>
<li><p><strong>IBUF_BITMAP</strong>：表空间第 1 个区的第 2 个页，这个页就是插入缓存bitmap页，用于记录插入缓冲区的一些信息。主要用于跟踪随后的每个page的change buffer信息，使用4个bit来描述每个page的change buffer信息。如图，IBUF_BITMAP 占用了 1 个 Page；</p>
</li>
<li><p><strong>INODE</strong>：表空间第 1 个区的第 3 个页，InnoDB 为每个索引定义了 2 个段，INODE Entry 结构记录了关于段的相关属性信息。如图，INODE 也占用了 1 个 Page。</p>
</li>
</ul>
<blockquote>
<p>名词解释</p>
<ol>
<li>FIL_PAGE_INDEX: B+tree叶节点</li>
<li>FIL_PAGE_UNDO_LOG：undo log页</li>
<li>FIL_PAGE_INODE：索引节点</li>
<li>FIL_PAGE_IBUF_FREE_LIST：insert buffer空闲列表</li>
<li>FIL_PAGE_TYPE_ALLOCATED：该页为最新分配</li>
<li>FIL_PAGE_IBUF_BITMAP：insert buffer位图</li>
<li>FIL_PAGE_TYPE_SYS：系统页</li>
<li>FIL_PAGE_TYPE_TRX_SYS：事务系统数据</li>
<li>FIL_PAGE_TYPE_FSP_HDR：File Space Header</li>
<li>FIL_PAGE_TYPE_XDES：扩展描述页</li>
<li>FIL_PAGE_TYPE_BLOB：blob页</li>
</ol>
</blockquote>
<p>如图，我们还可以知道索引的分布情况。也可以通过 information_schema 库表 INNODB_SYS_INDEXES、INNODB_SYS_TABLES 查看：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MySQL hadoop<span class="variable">@localhost</span>:tbl_innodb_ruby<span class="operator">&gt;</span> <span class="keyword">SELECT</span> sys_tbls.name, sys_idxs.name, sys_idxs.index_id, type, sys_idxs.space, sys_idxs.PAGE_NOFROM information_schema.INNODB_SYS_INDEXES sys_idxs, information_schema.INNODB_SYS_TABLES sys_tbls <span class="keyword">WHERE</span> sys_idxs.table_id <span class="operator">=</span> sys_tbls.table_i</span><br><span class="line">                                     <span class="operator">-</span><span class="operator">&gt;</span> d <span class="keyword">AND</span> sys_tbls.name<span class="operator">=</span><span class="string">&#x27;test_innodb_ruby/t_people&#x27;</span> <span class="keyword">AND</span> sys_idxs.space <span class="operator">&lt;&gt;</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327165318132.png" alt="image-20230327165318132" style="zoom:50%;">

<p>如图，其中 PAGE_NO 为 3 的 Page 保存了 PRIMARY 的信息，索引的编号是 85. PAGE_NO为4的page保存了idx_user_id辅助索引的信息，索引编号是86</p>
<h4 id="查看t-people表数据行分布情况："><a href="#查看t-people表数据行分布情况：" class="headerlink" title="查看t_people表数据行分布情况："></a>查看t_people表数据行分布情况：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people space-index-pages-summary | sed <span class="string">&#x27;s/[,#$@!%~ ][ ]*/\t/g&#x27;</span> | sed <span class="string">&#x27;s/\t/,/g&#x27;</span> | sed <span class="string">&#x27;s/.$//&#x27;</span> | csvlook | <span class="built_in">head</span> -n 100</span></span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327165844024.png" alt="image-20230327165844024" style="zoom:50%;">

<p>这个选项可以获取到的信息较上一个选项粒度更细了，可以看到页号（page 列）、索引编号（index 列）、也可以得到树的高度（level 字段 + 1，如图我们的 t_people 表的树高是 3 层）、同时可以看到数据在每个 Page 的占用情况（data 列）、每个 Page 空闲的空间（free 列）、每个 Page 有多少行数据（records 列），都可以通过 space-index-pages-summary 选项获取到。</p>
<blockquote>
<p>小提示</p>
<p>这里还是要补充一个知识点，我认为比较重要。细心的你可能会发现，上图中，很多 Page 的 free 空闲空间都是 1032 字节，我们知道 InnoDB 一个 Page 是 16KB（16384 字节），但是感觉为什么一个 Page 的空间没有被完全分配掉，会剩余 1&#x2F;16 的空闲空间？这就要涉及到一个知识点，有关于 InnoDB Page 的填充率。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MySQL hadoop<span class="variable">@localhost</span>:tbl_innodb_ruby<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;innodb%fill%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name      <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> innodb_fill_factor <span class="operator">|</span> <span class="number">100</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+-------+</span></span><br></pre></td></tr></table></figure>

<p>控制 Page 填充率参数 innodb_fill_factor 默认值是 100，也就是 100% 填充，但是，MySQL 官档中有这样两段描述。</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vNS43L2VuL2lubm9kYi1wYXJhbWV0ZXJzLmh0bWw=">https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html<i class="fa fa-external-link-alt"></i></span></p>
<p><img src="/mysql/learn-mysql-021/modb_20211120_752ec134-49b6-11ec-adf3-38f9d3cd240d.png" loading="lazy"></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vNS43L2VuL2lubm9kYi1waHlzaWNhbC1zdHJ1Y3R1cmUuaHRtbA==">https://dev.mysql.com/doc/refman/5.7/en/innodb-physical-structure.html<i class="fa fa-external-link-alt"></i></span></p>
<p><img src="/mysql/learn-mysql-021/modb_20211120_753e74a8-49b6-11ec-adf3-38f9d3cd240d.png" loading="lazy"></p>
</blockquote>
<blockquote>
<p>解释一下上面的这两段话：</p>
<p>1、innodb_fill_factor&#x3D;100，也会预留 1&#x2F;16 的空闲空间，用于现存记录长度扩展使用；</p>
<p>2、预留 1&#x2F;16 这个规则，只针对聚集索引（Clustered Index）的叶子节点有效。对于聚集索引的非叶子节点（Non-Leaf）以及辅助索引（叶子及非叶子）节点都没有这个规则；</p>
<p>3、innodb_fill_factor 选项对 B + 树索引的叶子节点及非叶子节点都有效，但对数据类型 TEXT&#x2F;BLOB 可能发生行溢出的 Page 无效；</p>
<p>4、在最佳的顺序插入数据模式下，Page 填充率有可能可以达到 15&#x2F;16；</p>
<p>5、在随机插入数据模式下，Page 填充率大约为 1&#x2F;2~15&#x2F;16。  </p>
</blockquote>
<h4 id="查看对应表空间的区-Extent-信息"><a href="#查看对应表空间的区-Extent-信息" class="headerlink" title="查看对应表空间的区(Extent)信息"></a>查看对应表空间的区(Extent)信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people space-extents-illustrate</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327171348204.png" alt="image-20230327171348204" style="zoom:50%;">

<img src="/mysql/learn-mysql-021/image-20230327171458177.png" alt="image-20230327171348204" style="zoom:50%;">

<blockquote>
<p>如图可得，我们 words 的表空间总共连续分配了 5952&#x2F;64 + 1 &#x3D; 93 + 1 &#x3D; 94 个区（Extent），一个区是 64 个 Page（大家应该还记得这个数字），分别以页号（PAGE_NO）0、64、128、192、256、320 为每个区的起始页。System（就是我们之前说的 FSP_HDR、IBUF_BITMAP、INODE）共计 3 个 Page，占用总分配空间的 0.05；Index 编号为 85 的聚集索引（存放真实数据）共计 3616 个 Page，占用总分配空间的 60.11%；Index编号为86的辅助索引共计1555个page，占用总分配空间的25.85%； Free space 空闲空间（分配但未使用的空间）共计 842 个 Page，占用总分配空间的 14.00%。</p>
</blockquote>
<h4 id="查看段的相关属性信息-INODE"><a href="#查看段的相关属性信息-INODE" class="headerlink" title="查看段的相关属性信息(INODE)"></a>查看段的相关属性信息(INODE)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看统计信息</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people space-inodes-summary</span></span><br><span class="line">INODE fseg_id=1, pages=5, frag=5, full=0, not_full=0, free=0</span><br><span class="line">INODE fseg_id=2, pages=4128, frag=32, full=55, not_full=9, free=0</span><br><span class="line">INODE fseg_id=3, pages=4, frag=4, full=0, not_full=0, free=0</span><br><span class="line">INODE fseg_id=4, pages=1824, frag=32, full=23, not_full=5, free=0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看详细信息</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people space-inodes-detail</span></span><br><span class="line">INODE fseg_id=1, pages=5, frag=5 pages (3, 133, 134, 135, 138), full=0 extents (), not_full=0 extents () (0/0 pages used), free=0 extents ()</span><br><span class="line">INODE fseg_id=2, pages=4128, frag=32 pages (5, 6, 7, 8, 9, 12, 13, 14, 17, 18, 19, 20, 21, 22, 24, 27, 28, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 41, 43, 45, 47, 51), full=55 extents (64-127, 192-255, 320-383, 384-447, 512-575, 576-639, 640-703, 832-895, 960-1023, 1024-1087, 1088-1151, 1152-1215, 1216-1279, 1280-1343, 1600-1663, 1792-1855, 1856-1919, 1920-1983, 1984-2047, 2048-2111, 1408-1471, 2240-2303, 2304-2367, 2368-2431, 1536-1599, 2624-2687, 2752-2815, 2816-2879, 3072-3135, 3200-3263, 3456-3519, 3584-3647, 3648-3711, 3712-3775, 3776-3839, 3840-3903, 3904-3967, 4032-4095, 4096-4159, 4160-4223, 4224-4287, 4288-4351, 4352-4415, 4480-4543, 4544-4607, 4672-4735, 4736-4799, 4800-4863, 4928-4991, 5056-5119, 5120-5183, 5312-5375, 5440-5503, 5632-5695, 5760-5823), not_full=9 extents (2112-2175, 2176-2239, 2496-2559, 2944-3007, 3328-3391, 3968-4031, 4416-4479, 5248-5311, 5888-5951) (59/576 pages used), free=0 extents ()</span><br><span class="line">INODE fseg_id=3, pages=4, frag=4 pages (4, 136, 137, 139), full=0 extents (), not_full=0 extents () (0/0 pages used), free=0 extents ()</span><br><span class="line">INODE fseg_id=4, pages=1824, frag=32 pages (10, 11, 15, 16, 23, 25, 26, 29, 40, 42, 44, 46, 48, 49, 50, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 128, 129, 130, 131, 132), full=23 extents (256-319, 448-511, 704-767, 768-831, 896-959, 1344-1407, 1472-1535, 1664-1727, 1728-1791, 2432-2495, 2560-2623, 2688-2751, 2880-2943, 3008-3071, 3136-3199, 3264-3327, 3392-3455, 3520-3583, 4608-4671, 4864-4927, 4992-5055, 5184-5247, 5376-5439), not_full=5 extents (5504-5567, 5568-5631, 5696-5759, 5824-5887, 5952-6015) (47/320 pages used), free=0 extents ()</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li><p>如图可得，记录系统 3 个固定的页的 fseg_id（段号：Segment ID）为 1，且总共占用 5 个 Page。</p>
</li>
<li><p>fseg_id为2的信息就比较丰富了：分配的空间总共占用了4128个Page，frag（空闲空间的碎片区：零散的页）共占用了32个Page，并且详细记录了这32个Page的页号（PAGE_NO）</p>
</li>
<li><p>状态为full（FULL_FRAG链表）的区一共有55个，总共占用两个完整区的55*64个页，括号中的是页号（PAGE_NO）</p>
</li>
<li><p>状态为not_full（FREE_FRAG）的区（FREE_FRAG链表）总共有9个，其中已经使用的页59个，未使用9*64-59 &#x3D; 517个Page</p>
</li>
</ol>
</blockquote>
<blockquote>
<p>小提示</p>
<p><strong>这个&#39;frag&#x3D;32&#39;需要注意，我们知道当段中数据已经占满了 32 个零散的页后，就直接申请完整的区来插入数据了。但是，本例正好为 32 个零散 Page 的临界值，还没有申请完整的区来插入数据，所以这 32 个 Page 还是属于段中的零散页范畴，不属于任何区，InnoDB 还是以 Page 为单位来进行管理，所以页号（PAGE_NO）也会被单独展示出来，这点需要注意</strong>。</p>
<p><strong>呼应上述&#39;frag&#x3D;32&#39;，&#39;not_full&#x3D;9 extents (2112-2175, 2176-2239, 2496-2559, 2944-3007, 3328-3391, 3968-4031, 4416-4479, 5248-5311, 5888-5951) (59&#x2F;576 pages used)&#39;这个状态为 FREE_FRAG 的区（FREE_FRAG 链表）因为已经使用 59 个 Page，所以就以整个区（Extent）为单位进行管理了。&#39;pages&#x3D;4128&#39;就是相当于 55+9 个完整的区加上 32 个零散的页（(55+9)×64+32&#x3D;4128），哈哈是不是感觉很有意思</strong>。</p>
</blockquote>
<h4 id="查看索引结构和数据分布情况"><a href="#查看索引结构和数据分布情况" class="headerlink" title="查看索引结构和数据分布情况"></a>查看索引结构和数据分布情况</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people space-indexes | sed &#x27;s/[,#$@!%~ ][ ]*/\t/g&#x27; | sed &#x27;s/\t/,/g&#x27; | sed &#x27;s/.$//&#x27; | csvlook</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327180443634.png" alt="image-20230327180443634" style="zoom:50%;">

<blockquote>
<p>列说明： </p>
<p>name：索引的名称，PRIMARY 代表的就是聚集索引，因为 InnoDB 表是索引组织表，行记录就是聚集索引；idx_user_id 就是辅助索引的名称。<br>root：索引中根节点的 page 号；可以看出聚集索引的根节点是第 3 个 page（为什么是从第三个 page 开始，看下文 space-page-type-regions），辅助索引的根节点是第 4 个 page。<br>fseg：page 的说明，internal 表示非叶子节点或属于根节点，leaf 表示叶子节点（也就是数据页）。<br>used：索引使用了多少个 page，可以看出聚集索引的根节点使用了 5 个 page，叶子节点使用了 3611 个 page；辅助索引 idx_user_id 的叶子节点使用了 1511 个 page。<br>allocated：索引分配了多少个 page，可以看出聚集索引的根节点分配了 5 个 page，叶子节点分配了 4128 个 page；辅助索引 idx_user_id 的叶子节点分配了 1824 个 page<br>fill_factor：索引的填充度，所有的填充度都是 100%。</p>
</blockquote>
<h4 id="查看表空间所有页面的LSN"><a href="#查看表空间所有页面的LSN" class="headerlink" title="查看表空间所有页面的LSN"></a>查看表空间所有页面的LSN</h4><p>lsn:（Log Sequence Number：日志逻辑序列号，不仅存在于 Redo Log，同时，File Header 部分的 FIL_PAGE_LSN 属性也记录着页面被最后修改时对应的日志序列位置）  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people space-lsn-age-illustrate</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327181438638.png" alt="image-20230327181438638" style="zoom:50%;">

<h3 id="Index-B-树索引-相关"><a href="#Index-B-树索引-相关" class="headerlink" title="Index(B+树索引)相关"></a>Index(B+树索引)相关</h3><h4 id="遍历聚集索引整个B-树，扫描所有页面"><a href="#遍历聚集索引整个B-树，扫描所有页面" class="headerlink" title="遍历聚集索引整个B+树，扫描所有页面"></a>遍历聚集索引整个B+树，扫描所有页面</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -I PRIMARY  index-recurse | head -n 25</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327181655575.png" alt="image-20230327181655575" style="zoom:50%;">

<blockquote>
<p>这条命令会从 root 开始，全表扫描，以升序的方式遍历整个 B+Tree 索引树，遍历过程中会输出每个 page 以及指针的信息，包括叶子节点 Page 和非叶子节点 Page。</p>
</blockquote>
<h4 id="遍历聚集索引B-树的数据页Page和记录Record的偏移量"><a href="#遍历聚集索引B-树的数据页Page和记录Record的偏移量" class="headerlink" title="遍历聚集索引B+树的数据页Page和记录Record的偏移量"></a>遍历聚集索引B+树的数据页Page和记录Record的偏移量</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -I PRIMARY index-record-offsets | head -n 25</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327181819041.png" alt="image-20230327181819041" style="zoom:50%;">

<blockquote>
<p>和 index-recurse 选项功能类似，但是遍历出的结果是偏移量。</p>
</blockquote>
<h4 id="查看指定Level-B-树高-的所有页面信息"><a href="#查看指定Level-B-树高-的所有页面信息" class="headerlink" title="查看指定Level(B+树高)的所有页面信息"></a>查看指定Level(B+树高)的所有页面信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># -l 0, 1, 2</span><br><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -I PRIMARY -l 0 index-level-summary | head -n 25</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327181952283.png" alt="image-20230327181952283" style="zoom:50%;">

<blockquote>
<p>我们 words 表的 B + 树树高只有 3 层，所以只能查得 3 层的数据。还有很多功能选项，大家感兴趣可以自己尝试。</p>
</blockquote>
<h3 id="Page-数据页-相关"><a href="#Page-数据页-相关" class="headerlink" title="Page(数据页)相关"></a>Page(数据页)相关</h3><h4 id="查看指定页号-PAGE-NO-的数据页说明信息"><a href="#查看指定页号-PAGE-NO-的数据页说明信息" class="headerlink" title="查看指定页号(PAGE_NO)的数据页说明信息"></a>查看指定页号(PAGE_NO)的数据页说明信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -p 3  page-account</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327182305370.png" alt="image-20230327182305370" style="zoom:50%;">

<blockquote>
<p>由图可知，Page 的类型是 B+Tree 索引；第 0 到 63 页的区（Extent）描述符位于第 0 号 Page 偏移量 158 处；区（Extent）未完全分配、可能有碎片区（零散页）；该 Page 被区（Extent）描述符所标记，该区（Extent）属于 FREE_FRAG 状态的 List；该 Page 位于 FSEG 1 的段 Fragment Array（碎片数组中；该 FSEG（段）位于索引 ID 为 85 的内部段中；索引的根页面是 Page 3（PAGE_NO&#x3D;3，也就是当前页就是根页面）；索引是 tbl_innodb_ruby&#x2F;t_people 表的主键（聚集索引）。</p>
<p>可以根据 space-index-pages-summary 功能选项，查看任何 1 个 Page 的说明信息</p>
<ol>
<li>-p 0 表示的是FSP_HDR.</li>
<li>-p 1 表示的是IBUF_BITMAP</li>
<li>-p 2 表示的是INODE</li>
</ol>
</blockquote>
<h4 id="查看指定页号-PAGE-NO-页目录的信息"><a href="#查看指定页号-PAGE-NO-页目录的信息" class="headerlink" title="查看指定页号(PAGE_NO)页目录的信息"></a>查看指定页号(PAGE_NO)页目录的信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -p 4128  page-directory-summary</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327182937848.png" alt="image-20230327182937848" style="zoom:50%;">

<blockquote>
<p>由图可得，Slot 编号、偏移量、数据类型（infimum - 最小值、node_pointer - 节点指针、supremum - 最大值）、每个槽位拥有的数据量（owned）、还有索引key（聚集索引或者辅助索引）值信息。</p>
</blockquote>
<h4 id="查看聚集索引的非叶子节点（Clustered-Index-Non-Leaf）记录-Record-信息"><a href="#查看聚集索引的非叶子节点（Clustered-Index-Non-Leaf）记录-Record-信息" class="headerlink" title="查看聚集索引的非叶子节点（Clustered Index Non-Leaf）记录 Record 信息"></a>查看聚集索引的非叶子节点（Clustered Index Non-Leaf）记录 Record 信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -p 3 page-records | head -n 25</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327183306953.png" alt="image-20230327183306953" style="zoom:50%;">

<blockquote>
<p>如图，<strong>存储的是主键值 + 页号（PAGE_NO）</strong>。</p>
<p>其中 -p 3 是根据 index-level-summary -I PRIMARY -l 2 得到的</p>
</blockquote>
<h4 id="查看聚集索引的叶子节点-Clustered-Index-Leaf-记录Record信息"><a href="#查看聚集索引的叶子节点-Clustered-Index-Leaf-记录Record信息" class="headerlink" title="查看聚集索引的叶子节点(Clustered Index Leaf)记录Record信息"></a>查看聚集索引的叶子节点(Clustered Index Leaf)记录Record信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -p 5 page-records | head -n 25</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327183647822.png" alt="image-20230327183647822" style="zoom:50%;">

<blockquote>
<p>如图，<strong>存储的是完整的记录</strong>。 </p>
<p>其中 -p 5 是根据 index-level-summary -I PRIMARY -l 0 得到的</p>
</blockquote>
<h4 id="查看辅助索引的非叶子节点（Secondary-Index-Non-Leaf）记录-Record-信息："><a href="#查看辅助索引的非叶子节点（Secondary-Index-Non-Leaf）记录-Record-信息：" class="headerlink" title="查看辅助索引的非叶子节点（Secondary Index Non-Leaf）记录 Record 信息："></a>查看辅助索引的非叶子节点（Secondary Index Non-Leaf）记录 Record 信息：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -p 136 page-records | head -n 25</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327184200586.png" alt="image-20230327184200586" style="zoom:50%;">

<blockquote>
<p>如图，<strong>存储的是辅助索引字段值 + 页号（PAGE_NO）</strong>。</p>
<p>其中-p 136 是是根据 -I idx_user_id -l 1 index-level-summary 得到的</p>
</blockquote>
<h4 id="查看辅助索引的叶子节点-Secondary-Index-Leaf-记录-Record-信息"><a href="#查看辅助索引的叶子节点-Secondary-Index-Leaf-记录-Record-信息" class="headerlink" title="查看辅助索引的叶子节点(Secondary Index Leaf)记录 Record 信息"></a>查看辅助索引的叶子节点(Secondary Index Leaf)记录 Record 信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -p 10 page-records | head -n 25</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327184524277.png" alt="image-20230327184524277" style="zoom:50%;">

<blockquote>
<p>如图，<strong>存储的是辅助索引字段值 + 主键值</strong>。</p>
<p>其中-p 136 是是根据 -I idx_user_id -l 0 index-level-summary 得到的</p>
</blockquote>
<p>到这里，是不是再回头看之前的文章，有一种：“我悟了！” 的感觉。  </p>
<h4 id="查看t-people表空间数据页Page的详细的各属性信息："><a href="#查看t-people表空间数据页Page的详细的各属性信息：" class="headerlink" title="查看t_people表空间数据页Page的详细的各属性信息："></a>查看t_people表空间数据页Page的详细的各属性信息：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -p 3 page-dump</span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line">#&lt;Innodb::Page::Index:0x0000000104b7d9a0&gt;:</span><br><span class="line"><span class="comment"># 文件头</span></span><br><span class="line">fil <span class="symbol">header:</span></span><br><span class="line">#&lt;struct Innodb::Page::FilHeader</span><br><span class="line"> # 页的checksum值</span><br><span class="line"> checksum=1222139710,</span><br><span class="line"> # 表空间中页的偏移量</span><br><span class="line"> offset=3,</span><br><span class="line"> # 当前页的上一个页，B+Tree特性决定了叶子结点必须是双向列表</span><br><span class="line"> prev=nil,</span><br><span class="line"> # 当前页的下一个页，B+Tree特性决定了叶子结点必须是双向列表</span><br><span class="line"> next=nil,</span><br><span class="line"> # 代表该页最后被修改的日志序列位置LSN（Log Sequence Number）</span><br><span class="line"> lsn=1381530869,</span><br><span class="line"> # InnoDB存储引擎页的类型</span><br><span class="line"> type=:INDEX,</span><br><span class="line"> # 如果页存放在系统共享表空间，表示文件至少被更新到了该LSN值；对于独立表空间，都为0</span><br><span class="line"> flush_lsn=0,</span><br><span class="line"> # 代表页属于哪个表空间</span><br><span class="line"> space_id=53&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件结尾信息</span></span><br><span class="line">fil <span class="symbol">trailer:</span></span><br><span class="line"><span class="comment"># 检测页是否完整写入磁盘。前4字节代表页的checksum值，最后4字节和File Header中的FIL_PAGE_LSN(lsn)相同。checksum的默认算法是crc32</span></span><br><span class="line">#&lt;struct Innodb::Page::FilTrailer checksum=1222139710, lsn_low32=1381530869&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 页头</span></span><br><span class="line">page <span class="symbol">header:</span></span><br><span class="line">#&lt;struct Innodb::Page::Index::PageHeader</span><br><span class="line"> # 在Page Directory页目录中的Slot槽数</span><br><span class="line"> n_dir_slots=2,</span><br><span class="line"> # 堆中第一个记录的指针，记录在页中是根据堆的形式存放的</span><br><span class="line"> heap_top=172,</span><br><span class="line"> n_heap_format=32774,</span><br><span class="line"> # 堆中的记录数。一共占用2字节，但是第15位表示行记录格式</span><br><span class="line"> n_heap=6,</span><br><span class="line"> format=:compact,</span><br><span class="line"> # 已删除记录的字节数，即行记录结构中delete flag为1的记录大小的总数</span><br><span class="line"> garbage_offset=0,</span><br><span class="line"> garbage_size=0,</span><br><span class="line"> # 最后插入记录的位置</span><br><span class="line"> last_insert_offset=164,</span><br><span class="line"> # 最后插入的方向</span><br><span class="line"> direction=:right,</span><br><span class="line"> n_direction=3,</span><br><span class="line"> # 该页中记录的数量</span><br><span class="line"> n_recs=4,</span><br><span class="line"> # 修改当前页面的最大事务ID，注意该值仅在Secondary Index中定义</span><br><span class="line"> max_trx_id=0,</span><br><span class="line"> # 当前页在索引树中的位置，0x00代表叶节点，叶节点总是在第0层</span><br><span class="line"> level=2,</span><br><span class="line"> # 索引ID，表示当前页属于哪个索引</span><br><span class="line"> index_id=85&gt;</span><br><span class="line"></span><br><span class="line">fseg <span class="symbol">header:</span></span><br><span class="line">#&lt;struct Innodb::Page::Index::FsegHeader</span><br><span class="line"> leaf=</span><br><span class="line">  &lt;Innodb::Inode space=&lt;Innodb::Space file=&quot;tbl_innodb_ruby/t_people.ibd&quot;, page_size=16384, pages=6656&gt;, fseg=<span class="number">2</span>&gt;,</span><br><span class="line"> internal=</span><br><span class="line">  &lt;<span class="title class_">Innodb</span><span class="symbol">:</span><span class="symbol">:Inode</span> space=&lt;<span class="title class_">Innodb</span><span class="symbol">:</span><span class="symbol">:Space</span> file=<span class="string">&quot;tbl_innodb_ruby/t_people.ibd&quot;</span>, page_size=<span class="number">16384</span>, pages=<span class="number">6656</span>&gt;, fseg=<span class="number">1</span>&gt;&gt;</span><br><span class="line"></span><br><span class="line"><span class="symbol">sizes:</span></span><br><span class="line">  header           <span class="number">120</span></span><br><span class="line">  trailer            <span class="number">8</span></span><br><span class="line">  directory          <span class="number">4</span></span><br><span class="line">  free           <span class="number">16200</span></span><br><span class="line">  used             <span class="number">184</span></span><br><span class="line">  record            <span class="number">52</span></span><br><span class="line">  per record     <span class="number">13.00</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 页目录</span></span><br><span class="line">page <span class="symbol">directory:</span></span><br><span class="line">[<span class="number">99</span>, <span class="number">112</span>]</span><br><span class="line"></span><br><span class="line">system <span class="symbol">records:</span></span><br><span class="line">#&lt;struct Innodb::Page::Index::SystemRecord</span><br><span class="line"> offset=99,</span><br><span class="line"> header=</span><br><span class="line">  #&lt;struct Innodb::Page::Index::RecordHeader</span><br><span class="line">   length=5,</span><br><span class="line">   next=125,</span><br><span class="line">   type=:infimum,</span><br><span class="line">   heap_number=0,</span><br><span class="line">   n_owned=1,</span><br><span class="line">   info_flags=0,</span><br><span class="line">   offset_size=nil,</span><br><span class="line">   n_fields=nil,</span><br><span class="line">   nulls=nil,</span><br><span class="line">   lengths=nil,</span><br><span class="line">   externs=nil&gt;,</span><br><span class="line"> <span class="keyword">next</span>=<span class="number">125</span>,</span><br><span class="line"> data=<span class="string">&quot;infimum\x00&quot;</span>,</span><br><span class="line"> length=<span class="number">8</span>&gt;</span><br><span class="line">#&lt;struct Innodb::Page::Index::SystemRecord</span><br><span class="line"> offset=112,</span><br><span class="line"> header=</span><br><span class="line">  #&lt;struct Innodb::Page::Index::RecordHeader</span><br><span class="line">   length=5,</span><br><span class="line">   next=112,</span><br><span class="line">   type=:supremum,</span><br><span class="line">   heap_number=1,</span><br><span class="line">   n_owned=5,</span><br><span class="line">   info_flags=0,</span><br><span class="line">   offset_size=nil,</span><br><span class="line">   n_fields=nil,</span><br><span class="line">   nulls=nil,</span><br><span class="line">   lengths=nil,</span><br><span class="line">   externs=nil&gt;,</span><br><span class="line"> <span class="keyword">next</span>=<span class="number">112</span>,</span><br><span class="line"> data=<span class="string">&quot;supremum&quot;</span>,</span><br><span class="line"> length=<span class="number">8</span>&gt;</span><br><span class="line"></span><br><span class="line">garbage <span class="symbol">records:</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">records:</span></span><br><span class="line">#&lt;struct Innodb::Page::Index::UserRecord</span><br><span class="line"> type=:clustered,</span><br><span class="line"> format=:compact,</span><br><span class="line"> offset=125,</span><br><span class="line"> header=</span><br><span class="line">  #&lt;struct Innodb::Page::Index::RecordHeader</span><br><span class="line">   length=5,</span><br><span class="line">   next=138,</span><br><span class="line">   type=:node_pointer,</span><br><span class="line">   heap_number=2,</span><br><span class="line">   n_owned=0,</span><br><span class="line">   info_flags=1,</span><br><span class="line">   offset_size=nil,</span><br><span class="line">   n_fields=nil,</span><br><span class="line">   nulls=[],</span><br><span class="line">   lengths=&#123;&#125;,</span><br><span class="line">   externs=[]&gt;,</span><br><span class="line"> <span class="keyword">next</span>=<span class="number">138</span>,</span><br><span class="line"> key=</span><br><span class="line">  [#&lt;struct Innodb::Page::Index::FieldDescriptor</span><br><span class="line">    name=&quot;id&quot;,</span><br><span class="line">    type=&quot;INT&quot;,</span><br><span class="line">    value=1,</span><br><span class="line">    extern=nil&gt;],</span><br><span class="line"> row=[],</span><br><span class="line"> sys=[],</span><br><span class="line"> child_page_number=<span class="number">133</span>,</span><br><span class="line"> transaction_id=<span class="literal">nil</span>,</span><br><span class="line"> roll_pointer=<span class="literal">nil</span>,</span><br><span class="line"> length=<span class="number">8</span>&gt;</span><br><span class="line"></span><br><span class="line">#&lt;struct Innodb::Page::Index::UserRecord</span><br><span class="line"> type=:clustered,</span><br><span class="line"> format=:compact,</span><br><span class="line"> offset=138,</span><br><span class="line"> header=</span><br><span class="line">  #&lt;struct Innodb::Page::Index::RecordHeader</span><br><span class="line">   length=5,</span><br><span class="line">   next=151,</span><br><span class="line">   type=:node_pointer,</span><br><span class="line">   heap_number=3,</span><br><span class="line">   n_owned=0,</span><br><span class="line">   info_flags=0,</span><br><span class="line">   offset_size=nil,</span><br><span class="line">   n_fields=nil,</span><br><span class="line">   nulls=[],</span><br><span class="line">   lengths=&#123;&#125;,</span><br><span class="line">   externs=[]&gt;,</span><br><span class="line"> <span class="keyword">next</span>=<span class="number">151</span>,</span><br><span class="line"> key=</span><br><span class="line">  [#&lt;struct Innodb::Page::Index::FieldDescriptor</span><br><span class="line">    name=&quot;id&quot;,</span><br><span class="line">    type=&quot;INT&quot;,</span><br><span class="line">    value=166430,</span><br><span class="line">    extern=nil&gt;],</span><br><span class="line"> row=[],</span><br><span class="line"> sys=[],</span><br><span class="line"> child_page_number=<span class="number">134</span>,</span><br><span class="line"> transaction_id=<span class="literal">nil</span>,</span><br><span class="line"> roll_pointer=<span class="literal">nil</span>,</span><br><span class="line"> length=<span class="number">8</span>&gt;</span><br><span class="line"></span><br><span class="line">#&lt;struct Innodb::Page::Index::UserRecord</span><br><span class="line"> type=:clustered,</span><br><span class="line"> format=:compact,</span><br><span class="line"> offset=151,</span><br><span class="line"> header=</span><br><span class="line">  #&lt;struct Innodb::Page::Index::RecordHeader</span><br><span class="line">   length=5,</span><br><span class="line">   next=164,</span><br><span class="line">   type=:node_pointer,</span><br><span class="line">   heap_number=4,</span><br><span class="line">   n_owned=0,</span><br><span class="line">   info_flags=0,</span><br><span class="line">   offset_size=nil,</span><br><span class="line">   n_fields=nil,</span><br><span class="line">   nulls=[],</span><br><span class="line">   lengths=&#123;&#125;,</span><br><span class="line">   externs=[]&gt;,</span><br><span class="line"> <span class="keyword">next</span>=<span class="number">164</span>,</span><br><span class="line"> key=</span><br><span class="line">  [#&lt;struct Innodb::Page::Index::FieldDescriptor</span><br><span class="line">    name=&quot;id&quot;,</span><br><span class="line">    type=&quot;INT&quot;,</span><br><span class="line">    value=499330,</span><br><span class="line">    extern=nil&gt;],</span><br><span class="line"> row=[],</span><br><span class="line"> sys=[],</span><br><span class="line"> child_page_number=<span class="number">135</span>,</span><br><span class="line"> transaction_id=<span class="literal">nil</span>,</span><br><span class="line"> roll_pointer=<span class="literal">nil</span>,</span><br><span class="line"> length=<span class="number">8</span>&gt;</span><br><span class="line"></span><br><span class="line">#&lt;struct Innodb::Page::Index::UserRecord</span><br><span class="line"> type=:clustered,</span><br><span class="line"> format=:compact,</span><br><span class="line"> offset=164,</span><br><span class="line"> header=</span><br><span class="line">  #&lt;struct Innodb::Page::Index::RecordHeader</span><br><span class="line">   length=5,</span><br><span class="line">   next=112,</span><br><span class="line">   type=:node_pointer,</span><br><span class="line">   heap_number=5,</span><br><span class="line">   n_owned=0,</span><br><span class="line">   info_flags=0,</span><br><span class="line">   offset_size=nil,</span><br><span class="line">   n_fields=nil,</span><br><span class="line">   nulls=[],</span><br><span class="line">   lengths=&#123;&#125;,</span><br><span class="line">   externs=[]&gt;,</span><br><span class="line"> <span class="keyword">next</span>=<span class="number">112</span>,</span><br><span class="line"> key=</span><br><span class="line">  [#&lt;struct Innodb::Page::Index::FieldDescriptor</span><br><span class="line">    name=&quot;id&quot;,</span><br><span class="line">    type=&quot;INT&quot;,</span><br><span class="line">    value=833329,</span><br><span class="line">    extern=nil&gt;],</span><br><span class="line"> row=[],</span><br><span class="line"> sys=[],</span><br><span class="line"> child_page_number=<span class="number">138</span>,</span><br><span class="line"> transaction_id=<span class="literal">nil</span>,</span><br><span class="line"> roll_pointer=<span class="literal">nil</span>,</span><br><span class="line"> length=<span class="number">8</span>&gt;</span><br></pre></td></tr></table></figure>

<p>查看下聚集索引的叶子节点的各项属性信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -p 3 page-dump | cat | grep -n -A 60 &#x27;^records:&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">93:records:</span><br><span class="line">94-#&lt;struct Innodb::Page::Index::UserRecord</span><br><span class="line">95- type=:clustered,</span><br><span class="line">96- format=:compact,</span><br><span class="line">97- offset=125,</span><br><span class="line">98- header=</span><br><span class="line">99-  #&lt;struct Innodb::Page::Index::RecordHeader</span><br><span class="line">100-   length=5,</span><br><span class="line">101-   next=138,</span><br><span class="line">102-   type=:node_pointer,</span><br><span class="line">103-   heap_number=2,</span><br><span class="line">104-   n_owned=0,</span><br><span class="line">105-   info_flags=1,</span><br><span class="line">106-   offset_size=nil,</span><br><span class="line">107-   n_fields=nil,</span><br><span class="line">108-   nulls=[],</span><br><span class="line">109-   lengths=&#123;&#125;,</span><br><span class="line">110-   externs=[]&gt;,</span><br><span class="line">111- next=138,</span><br><span class="line">112- key=</span><br><span class="line">113-  [#&lt;struct Innodb::Page::Index::FieldDescriptor</span><br><span class="line">114-    name=&quot;id&quot;,</span><br><span class="line">115-    type=&quot;INT&quot;,</span><br><span class="line">116-    value=1,</span><br><span class="line">117-    extern=nil&gt;],</span><br><span class="line">118- row=[],</span><br><span class="line">119- sys=[],</span><br><span class="line">120- child_page_number=133,</span><br><span class="line">121- transaction_id=nil,</span><br><span class="line">122- roll_pointer=nil,</span><br><span class="line">123- length=8&gt;</span><br><span class="line">124-</span><br><span class="line">125-#&lt;struct Innodb::Page::Index::UserRecord</span><br><span class="line">126- type=:clustered,</span><br><span class="line">127- format=:compact,</span><br><span class="line">128- offset=138,</span><br><span class="line">129- header=</span><br><span class="line">130-  #&lt;struct Innodb::Page::Index::RecordHeader</span><br><span class="line">131-   length=5,</span><br><span class="line">132-   next=151,</span><br><span class="line">133-   type=:node_pointer,</span><br><span class="line">134-   heap_number=3,</span><br><span class="line">135-   n_owned=0,</span><br><span class="line">136-   info_flags=0,</span><br><span class="line">137-   offset_size=nil,</span><br><span class="line">138-   n_fields=nil,</span><br><span class="line">139-   nulls=[],</span><br><span class="line">140-   lengths=&#123;&#125;,</span><br><span class="line">141-   externs=[]&gt;,</span><br><span class="line">142- next=151,</span><br><span class="line">143- key=</span><br><span class="line">144-  [#&lt;struct Innodb::Page::Index::FieldDescriptor</span><br><span class="line">145-    name=&quot;id&quot;,</span><br><span class="line">146-    type=&quot;INT&quot;,</span><br><span class="line">147-    value=166430,</span><br><span class="line">148-    extern=nil&gt;],</span><br><span class="line">149- row=[],</span><br><span class="line">150- sys=[],</span><br><span class="line">151- child_page_number=134,</span><br><span class="line">152- transaction_id=nil,</span><br><span class="line">153- roll_pointer=nil,</span><br></pre></td></tr></table></figure>

<p>如图展示的是一些 Page 的详细信息，大家看下图对号入座。</p>
<p><img src="/mysql/learn-mysql-021/modb_20211120_783b79ee-49b6-11ec-adf3-38f9d3cd240d.png" loading="lazy"></p>
<h4 id="查看某个Page各属性信息空间占用情况及百分比"><a href="#查看某个Page各属性信息空间占用情况及百分比" class="headerlink" title="查看某个Page各属性信息空间占用情况及百分比"></a>查看某个Page各属性信息空间占用情况及百分比</h4><ul>
<li>聚集索引非叶子节点页 &#x2F; 根页面（Clustered Index Non-Leaf）：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -p 3 page-illustrate</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327185142292.png" alt="image-20230327185142292" style="zoom:50%;">

<blockquote>
<p>红框部分为颜色说明及各属性空间占用百分比。</p>
</blockquote>
<ul>
<li>聚集索引的叶子节点页（Clustered Index Leaf）：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -p 5 page-illustrate</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327190015480.png" alt="image-20230327190015480" style="zoom:50%;">


<h3 id="Record-记录-相关"><a href="#Record-记录-相关" class="headerlink" title="Record(记录)相关"></a>Record(记录)相关</h3><h4 id="查看指定偏移量的记录Record详细信息"><a href="#查看指定偏移量的记录Record详细信息" class="headerlink" title="查看指定偏移量的记录Record详细信息"></a>查看指定偏移量的记录Record详细信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -p 5 -R 127 record-dump</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327190619666.png" alt="image-20230327190619666" style="zoom:50%;">

<h4 id="查看指定偏移量记录Record的历史记录-为指定偏移量记录的-UNDO-LOG"><a href="#查看指定偏移量记录Record的历史记录-为指定偏移量记录的-UNDO-LOG" class="headerlink" title="查看指定偏移量记录Record的历史记录(为指定偏移量记录的 UNDO LOG)"></a>查看指定偏移量记录Record的历史记录(为指定偏移量记录的 UNDO LOG)</h4><p>修改 tbl_innodb_ruby.t_people 表 id&#x3D;10 的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATe t_people SET c_name = &quot;ypb_test&quot; WHERE id=10;</span><br></pre></td></tr></table></figure>

<p>抓取 test_innodb_ruby.words 表所有记录和 Page 的对应关系：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people  -I PRIMARY index-recurse | grep -B 20 -n &#x27;(id=10)&#x27;</span><br></pre></td></tr></table></figure>

<p>定位 id&#x3D;10 的记录所在的 Page，获取 PAGE_NO：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people  -I PRIMARY index-recurse | grep -B 20 -n &#x27;(id=10)&#x27;</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327191903009.png" alt="image-20230327191903009" style="zoom:50%;">

<blockquote>
<p> 如图，我们看到数据已经被修改成&#39;ypb_test&#39;，且知道了 id&#x3D;10 这行数据所在的 Page 是 PAGE_NO&#x3D;5。  </p>
</blockquote>
<p>获取 t_people 表空间数据页 Page 的详细信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -p 5 page-dump | grep -B 35 -n  &quot;ypb_test&quot;</span><br></pre></td></tr></table></figure>

<p>获取 id&#x3D;10 这行记录的偏移量：</p>
<img src="/mysql/learn-mysql-021/image-20230327192114564.png" alt="image-20230327192114564" style="zoom:50%;">

<blockquote>
<p>如图，我们知道了偏移量是 offset&#x3D;613。所以我们就可以通过指定偏移量查询该条 Record 的历史记录。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_space -s ibdata1 -T tbl_innodb_ruby/t_people -p 5 -R 613 record-history</span><br></pre></td></tr></table></figure>

<img src="/mysql/learn-mysql-021/image-20230327192244144.png" alt="image-20230327192244144" style="zoom:50%;">
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/mysql5-7/" rel="tag"># mysql5.7</a>
              <a href="/tags/innobd-ruby/" rel="tag"># innobd_ruby</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/mysql/learn-mysql-020/" rel="prev" title="mysql学习笔记-MySQL 之 InnoDB 表空间">
                  <i class="fa fa-chevron-left"></i> mysql学习笔记-MySQL 之 InnoDB 表空间
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/mysql/binlog2sql/" rel="next" title="mysql学习笔记-Mysql工具之binlog2sql：基于Binlog对误操作恢复工具">
                  mysql学习笔记-Mysql工具之binlog2sql：基于Binlog对误操作恢复工具 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2014 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">NexT</span>
</div>
  <div class="powered-by">由 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <a href="https://theme-next.js.org/">NexT.Gemini</a> 强力驱动
  </div><div class="footer-custom">
Website source code <span class="exturl theme-link" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hleG8tbmV4dC9oZXhvLW5leHQuZ2l0aHViLmlv">here</span>
</div>


    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hhcHB5NTE4" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.15.0/comments.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.15.0/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.15.0/motion.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.15.0/next-boot.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.15.0/pjax.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.15.0/third-party/search/local-search.min.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.4.0/mermaid.min.js","integrity":"sha256-3JloMMI/ZQx6ryuhhZTsQJQmGAkXeni6PkshX7UUO2s="}}</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.15.0/third-party/tags/mermaid.min.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.15.0/third-party/math/mathjax.min.js"></script>



</body>
</html>
